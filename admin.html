<body>
    <h1>Government Admin Dashboard</h1>
    <table border="1" cellpadding="10">
        <thead>
            <tr>
                <th>Description</th>
                <th>Department</th>
                <th>Urgency</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="issuesTable">
            <!-- Firebase data will come here -->
        </tbody>
    </table>

    <script type="module">
        import { doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import {
            getFirestore,
            collection,
            getDocs
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAK3MdF8MKCClWra5sK9bxAbIz5p82igQo",
            authDomain: "ai-civic-issue-reporter-2.firebaseapp.com",
            projectId: "ai-civic-issue-reporter-2",
            storageBucket: "ai-civic-issue-reporter-2.firebasestorage.app",
            messagingSenderId: "730468321462",
            appId: "1:730468321462:web:4532b50322c7556bf4fe17"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function loadIssues() {
            const snapshot = await getDocs(collection(db, "issues"));
            const table = document.getElementById("issuesTable");

            // ðŸ”¥ CLEAR OLD ROWS FIRST
            table.innerHTML = "";

            snapshot.forEach(doc => {
                const issue = { id: doc.id, ...doc.data() };
                const row = document.createElement("tr");

                row.innerHTML = `
      <td>${issue.user_description}</td>
      <td>${issue.ai_analysis?.department || "N/A"}</td>
      <td>${issue.ai_analysis?.urgency || "N/A"}</td>
      <td>
  <select onchange="updateStatus('${issue.id}', this.value)">
    <option value="pending" ${issue.status === "pending" ? "selected" : ""}>Pending</option>
    <option value="in_progress" ${issue.status === "in_progress" ? "selected" : ""}>In Progress</option>
    <option value="resolved" ${issue.status === "resolved" ? "selected" : ""}>Resolved</option>
  </select>
</td>

    `;

                table.appendChild(row);
            });
        }


        loadIssues();
        window.updateStatus = async function (docId, newStatus) {
            const issueRef = doc(db, "issues", docId);

            await updateDoc(issueRef, {
                status: newStatus
            });

            console.log("Status updated:", docId, newStatus);
        };

    </script>
</body>